from classes.constant.waflog import WafLog
import settings
import subprocess
import shlex
from mongolayer import MongoLayer


xchangepath = settings.BASE_DIR +'/xchange/'
scriptpath = settings.BASE_DIR +'/ner/commands/'
trainpath = settings.BASE_DIR +'/ner/trainfiles/'

trainfile = 'waf_twittertrain_en.tok'
trainscript = 'waf_nertrain_en.sh'

class WafNer():
    
    def __init__(self):
        self.mongodb = MongoLayer()
        pass
    
    def wafTrain(self):
        cdcommand = 'cd '+ scriptpath
        command = 'ls '
        #command = 'sh '+ trainscript 
        WafLog().nerlogger.info('calling: %s' %cdcommand)
        subprocess.check_call(shlex.split(cdcommand))
        
        WafLog().nerlogger.info('calling: %s' %command)
        subprocess.check_call(shlex.split(command))
        
    def getSuspicous(self):

        result = self.mongodb.find({"$and":[
                                        {"$or":[
                                                {"dept":{}},
                                                {"arr":{}}
                                                ] 
                                        },
                                        {"language":"en"}
                                        ] 
                                   })
            
        for item in result:
            print(item.get("arr").string())
            WafLog().nerlogger.info(u'Text : {0: <200}  Arr:  {1: <15}  Dept  {2: <15} '.format('1',item.get("arr") if item.get("arr") is not None else 'null','3'))
                
        
        

if __name__ == '__main__':
    test = WafNer()
    test.getSuspicous()
    print('''Doneitem.get("text").encode('utf8')''')
                            
                            